---
import { getCollection } from 'astro:content'
import { Image } from 'astro:assets'
import BaseLayout from '@/layouts/BaseLayout.astro'

export async function getStaticPaths() {
  const posts = await getCollection('posts')
  return posts.map((post) => ({
    params: { slug: post.slug },
    props: { post },
  }))
}

const { post } = Astro.props
const { Content } = await post.render()
---

<BaseLayout title={post.data.title}>
  <div class="flex justify-center px-4">
    <div class="w-full max-w-sm md:max-w-2xl py-32">
      <h1 class="text-2xl md:text-3xl font-bold pb-6" transition:name={`post-${post.slug}`}>{post.data.title}</h1>
      <div class="flex text-xs md:text-sm text-zinc-400 tracking-wider space-x-2">
        <p>
          <time datetime={post.data.publishedDate.toISOString()}>
            {
              post.data.publishedDate.toLocaleDateString('en-us', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
              })
            }
          </time>
        </p>
        <span>&middot;</span>
        {post.data.tags.map((tag) => <a href={`/tags/${tag}`}>{`#${tag}`}</a>)}
      </div>

      {post.data.image && <Image src={post.data.image} alt={post.data.title} format="avif" height={300} width={300} class="w-full object-cover object-center mt-20" />}

      <article class="prose prose-sm md:prose-base prose-zinc prose-invert prose-code:text-xs md:prose-code:text-sm max-w-none mt-20">
        <Content />
      </article>
    </div>
  </div>
</BaseLayout>
